name: ğŸš€ FTP Deploy naar productie mbv Webhooks en Github Actions

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: Productie

    steps:
      - name: ğŸ” Deploy via Webhook
        run: |
          echo "â³ Start webhook call..."
          curl -s -X POST https://git.smarter.nl/webhook-actions/webhooks/deploy.php \
            -H "Content-Type: application/json" \
            -H "X-Smarter-Secret: ${{ secrets.WEBHOOK_SECRET }}" \
            -d '{"ref": "refs/heads/main"}'
          echo "âœ… Webhook gestart"

      - name: ğŸ“¥ Download server log (deploy.log)
        run: |
          echo "â¬ Downloaden van deploy.log..."
          curl -s https://git.smarter.nl/webhook-actions/webhooks/deploy.log -o deploy.log
          echo "âœ… Logbestand gedownload. Inhoud:"
          cat deploy.log

      - name: ğŸ“¦ Upload log als artifact
        uses: actions/upload-artifact@v4
        with:
          name: deploy-log
          path: deploy.log